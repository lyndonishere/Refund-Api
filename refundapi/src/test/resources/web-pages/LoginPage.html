<!DOCTYPE html>
<html lang="en">
<head>
    <title>Login Page</title>
    <link rel = "stylesheet" href = "LoginStyle.css">
</head>
<body>
    <h1>Please Login!</h1>
    <div id = "main-body">
        <input type = "text" id = "username" placeholder = "enter username">
        <br>
        <input type = "password" id = "password" placeholder = "enter password">
        <br>
    </div>
    <div id = "body-button">
        <button id = "login-button" onclick = "login()">login!</button>
    </div>
</body>
<script>
    // i need to set up a patch method to login
    const username = document.getElementById("username");
    const password = document.getElementById("password");


    // this is following previous project, need to check if this is all valid

    async function login(){
        // to let my api validate login information, I need to attach the username and password to the
        // http request
        let loginInfo = {
            username: username.value,
            user_password: password.value
        };

        // now that I have the actual login information, I need to convert it into a JSON
        let loginJSON = JSON.stringify(loginInfo);

        // now I can set up my HTTP request configurations
        let config = {
            method: "PATCH", // method is a reference to the kind of request you are making (the verb): GET is the default
            headers: {'Content-Type':"application/json"}, // some APIs will return an error message without this value included
            body: loginJSON // stringify converts a JS object into a JSON
        };

        console.log(loginJSON);
        let httpResponse = await fetch("http://localhost:8080/login", config);
        console.log(httpResponse.status);
        

        if(httpResponse.status === 200){
            let responseBody = await httpResponse.json();   // remember, json() returns a promise, so we use await to get the data we want out of it

            if(responseBody.user_role === "manager"){
                window.location.href = "ManagerPage.html"
            } else if(responseBody.user_role === "employee"){
                window.location.href = "EmployeePage.html"
            } else {
                alert("Could not login. User has not been assigned a role.")
            }
        } else {
            let responseBody = await httpResponse.json();
            alert("Plankton's stolen the login credentials!");
        }
       
    }
</script>
</html>